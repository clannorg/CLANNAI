# GAA Turnover Detection System

Clean, streamlined system for detecting GAA turnovers using AI video analysis.

## 🎯 What This Does

Analyzes GAA match video clips to detect **turnover events** (possession changes) and outputs them in GAA Events Schema format for your webapp.

## 📋 Requirements

- Python 3.8+
- Gemini API key (set in `.env` file as `GEMINI_API_KEY`)
- Video clips from `../3.5-video-splitting/clips/first_half/`

## 🚀 Quick Start

**Step 1: Analyze Video Clips**
```bash
python 1_analyze_clips.py
```
- Analyzes first 10 minutes of match (40 clips × 15 seconds each)
- Uses Gemini 2.5 Flash for speed
- Saves individual text analysis files

**Step 2: Create Event Timeline**
```bash
python 2_synthesize_events.py
```
- Uses Gemini 2.5 Pro for synthesis
- Converts analyses to GAA Events Schema JSON
- Ready for webapp consumption

## 📁 File Structure

```
5-turnovers/
├── 1_analyze_clips.py      # Video → Text analysis
├── 2_synthesize_events.py  # Text → GAA Events JSON
├── README.md               # This file
└── results/
    ├── turnover_analysis/  # Individual clip analyses
    └── webapp_output/      # Final JSON for webapp
        ├── turnover_events.json      # Main output
        └── analysis_summary.txt      # Human-readable summary
```

## 🔍 What Turnovers Are Detected

**Turnover Types:**
- **Interceptions**: Player intercepts pass meant for opponent
- **Tackles**: Player dispossesses opponent with ball
- **Fumbles**: Player drops ball, opponent recovers
- **Block Downs**: Player blocks kick/shot, opponent gets ball
- **Contested Catches**: High ball contested, opposite team wins
- **Loose Balls**: Ball becomes loose, opposite team gains control
- **Steals**: Player steals ball from opponent's possession

**Detection Criteria:**
- Clear possession change from Team A to Team B
- Moment of change visible in clip
- Active match play (not restarts)
- High confidence (≥7/10)

## 📊 Expected Output

**Frequency**: Turnovers are common in GAA - expect 10-20 in first 10 minutes

**GAA Events Schema Format:**
```json
{
  "match_info": {
    "title": "GAA Match - Turnover Events",
    "description": "AI-detected turnover events with exact timing",
    "total_events": 24,
    "analysis_method": "AI video analysis"
  },
  "events": [
    {
      "id": "turnover_1",
      "time": 91.3,
      "team": "red",
      "action": "Turnover",
      "outcome": "Won",
      "autoGenerated": true,
      "validated": false
    }
  ]
}
```

## ⚡ Performance

- **Analysis**: ~8 clips/second using 8 threads
- **Timing Precision**: Frame-accurate (down to 0.1 seconds)
- **Team Mapping**: Consistent red/blue based on jersey colors
- **Schema Validation**: Built-in GAA Events Schema compliance

## 🔧 Configuration

**Time Limit** (in `1_analyze_clips.py`):
```python
TIME_LIMIT_MINUTES = 10  # Change to analyze more/less time
```

**Threading** (in `1_analyze_clips.py`):
```python
MAX_WORKERS = 8  # Adjust based on your system
```

## 📈 Webapp Integration

The output `turnover_events.json` is ready to drop into your webapp:
- Schema-compliant GAA Events format
- Precise timing for video synchronization
- Red/blue team mapping
- Auto-generated flags for UI handling

## 🎬 Example Workflow

1. **Run Analysis**: Detect turnovers in video clips
2. **Generate Events**: Create webapp-ready JSON
3. **Upload to Webapp**: Drop JSON file into your system
4. **View Results**: See turnover events synchronized with video

## 💡 Tips

- Turnovers are much more frequent than kickouts (expect 20+ vs 2-4)
- Each turnover creates 2 events (one team loses, other gains)
- System maintains consistent team colors across all events
- All events marked as `autoGenerated: true` for validation workflow 